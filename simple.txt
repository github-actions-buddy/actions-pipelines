name: GitHub Actions PR Thread

on: 
  pull_request:
    types: [opened, reopened]

jobs:
  create_thread_job:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up GitHub CLI
      uses: actions/checkout@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: Create a new thread
      run: gh pr comment create --body "This is a new thread." --repo owner/repo --web

    - name: Update a comment
      run: gh pr comment create 1 --body "This is an updated comment." --repo owner/repo --web

    - name: Find the last comment
      run: |
        LAST_COMMENT=$(gh pr comment list --repo owner/repo --json body | jq '.[-1].body')
        echo "::set-output name=last_comment::$LAST_COMMENT"

    - name: Append a new comment after the last comment
      run: |
        gh pr comment create 1 --body "${{ steps.find_last_comment.outputs.last_comment }} New Comment" --repo owner/repo --web
